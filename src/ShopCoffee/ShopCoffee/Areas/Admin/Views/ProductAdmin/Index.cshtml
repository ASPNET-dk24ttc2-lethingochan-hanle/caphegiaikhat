@model X.PagedList.IPagedList<ShopCoffee.Database.Product>
@using X.PagedList.Mvc.Core

@{
    ViewData["Title"] = "Index";
    var stt = (Model.PageNumber - 1) * Model.PageSize + 1; // STT theo phân trang
}

<h3>Đồ uống</h3>

<form asp-action="Index" method="get" class="mb-3">
    <div class="d-flex g-2 align-items-center">
        <div class="row" style="display:flex; flex: 1; ">
            <div class="col-sm-6 ">
                <input type="text" name="searchString" value="@ViewData["CurrentFilter"]"
                       class="form-control" placeholder="Tìm kiếm...">
            </div>
            <div class="col-sm-6">
               <select name="categoryId" class="form-select w-100 me-2" style="display:inline-block;">
                    <option value="">-- Tất cả danh mục --</option>
                    @if (ViewBag.Categories != null)
                    {
                        @foreach (var cat in ViewBag.Categories as List<ShopCoffee.Database.Category> ?? new List<ShopCoffee.Database.Category>())
                        {
                            var isSelected = cat.CategoryId == (ViewData["CurrentCategory"] as int? ?? -1);

                            @:<option value="@cat.CategoryId" @(isSelected ==true ? "selected" : "")>@cat.Title</option>
                        }
                    }
                </select>
            </div>
        </div>
        <div class="col-auto">
            <button class="btn btn-primary" type="submit">Tìm kiếm</button>
            <a asp-area="Admin" asp-controller="ProductAdmin" asp-action="Index"  class="btn btn-outline-primary"  name="action" value="clear" style="margin-left: 3px">Xóa</a>
        </div>
    </div>
</form>

<p>
    <a asp-action="Create" class="btn btn-success">Thêm mới</a>
</p>

@* <div class="d-flex justify-content-center">
    @Html.PagedListPager(Model, page => Url.Action("Index", new
    {
        page,
        searchString = ViewData["CurrentFilter"],
        categoryId = ViewData["CurrentCategory"],
        sortOrder = ViewData["CurrentSort"]
        }),
        new X.PagedList.Mvc.Core.PagedListRenderOptions
        {
            LiElementClasses = new[] { "page-item" },
            PageClasses = new[] { "page-link" },
            UlElementClasses = new[] { "pagination" }
        })
</div> *@

<table class="table table-striped table-hover align-middle border">
    <thead class="table-primary">
        <tr>
            <th>STT</th>
            <th class="text-center">Ảnh</th>
            <th>
                <a asp-action="Index" asp-route-sortOrder="@ViewData["NameSortParm"]"
                   asp-route-searchString="@ViewData["CurrentFilter"]"
                   asp-route-categoryId="@ViewData["CurrentCategory"]">Tên món</a>
            </th>
            <th>
                <a asp-action="Index" asp-route-sortOrder="@ViewData["PriceSortParm"]"
                   asp-route-searchString="@ViewData["CurrentFilter"]"
                   asp-route-categoryId="@ViewData["CurrentCategory"]">Giá</a>
            </th>
            <th>
                <a asp-action="Index" asp-route-sortOrder="@ViewData["CreateAtSortParm"]"
                   asp-route-searchString="@ViewData["CurrentFilter"]"
                   asp-route-categoryId="@ViewData["CurrentCategory"]"> Ngày tạo</a>
            </th>
            <th style="white-space: nowrap">
                <a asp-action="Index" asp-route-sortOrder="@ViewData["UpdateAtSortParm"]"
                   asp-route-searchString="@ViewData["CurrentFilter"]"
                   asp-route-categoryId="@ViewData["CurrentCategory"]"> Ngày chỉnh sửa</a>
            </th>
            <th>Danh mục</th>
            <th></th>
        </tr>
    </thead>
    <tbody>
        @foreach (var item in Model)
        {
            <tr>
                <td>@stt</td>
                <td>
                    <img src="@item.Img" style="width:100px; aspect-ratio:1.5; object-fit:cover; border-radius:6px;" />
                </td>
                <td>@Html.DisplayFor(m => item.Title)</td>
                <td style="white-space:nowrap">@item.Price.ToString("N0") đ</td>
                <td>@item.CreateAt?.ToString("dd/MM/yyyy HH:mm:ss")</td>
                <td>@item.UpdateAt?.ToString("dd/MM/yyyy HH:mm:ss")</td>
                <td>@Html.DisplayFor(m => item.Category!.Title)</td>
                <td>
                    <div class="btn-group btn-group-sm" role="group">
                        <a asp-action="Edit" asp-route-id="@item.ProductId" class="btn btn-warning"><i class="fa fa-edit"></i></a>
                        <a asp-action="Details" asp-route-id="@item.ProductId" class="btn btn-primary"><i class="fa fa-eye"></i></a>
                        <a asp-action="Delete" asp-route-id="@item.ProductId" class="btn btn-danger"><i class="fa fa-trash"></i></a>
                    </div>
                </td>
            </tr>
            stt++;
        }
    </tbody>
</table>

<!-- Phân trang -->
<div class="d-flex justify-content-center">
    @Html.PagedListPager(Model, page => Url.Action("Index", new
    {
        page,
        searchString = ViewData["CurrentFilter"],
        categoryId = ViewData["CurrentCategory"],
        sortOrder = ViewData["CurrentSort"]
        }),
        new X.PagedList.Mvc.Core.PagedListRenderOptions
        {
            LiElementClasses = new[] { "page-item" },
            PageClasses = new[] { "page-link" },
            UlElementClasses = new[] { "pagination" }
        })
</div>
@* <div class="d-flex justify-content-center">
    @Html.PagedListPager(Model, page => Url.Action("Index", new
    {
        page,
        searchString = ViewData["CurrentFilter"],
        categoryId = ViewData["CurrentCategory"],
        sortOrder = ViewData["CurrentSort"]
    }), PagedListRenderOptions.Bootstrap5Full)
</div>
*@